# Resumen del C√≥digo Fuente - Asistente de Ventas IA

## Estructura General del Proyecto

### üìÅ Organizaci√≥n de Alto Nivel
```
aws-community-day-cdmx-2025/
‚îú‚îÄ‚îÄ .clinerules/                    # Configuraci√≥n de desarrollo
‚îú‚îÄ‚îÄ cline_docs/                     # Documentaci√≥n del proyecto
‚îú‚îÄ‚îÄ extension/                      # Chrome Extension source
‚îú‚îÄ‚îÄ aws-backend/                    # AWS serverless infrastructure
‚îú‚îÄ‚îÄ demos/                          # Prototipos y mockups interactivos
‚îú‚îÄ‚îÄ docs/                          # Documentaci√≥n t√©cnica adicional
‚îî‚îÄ‚îÄ scripts/                       # Scripts de build y despliegue
```

## Componentes Clave y Sus Interacciones

### üéØ Chrome Extension (Frontend)

#### Arquitectura de Componentes
```
extension/
‚îú‚îÄ‚îÄ manifest.json                   # Configuraci√≥n Manifest v3
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ background/                 # Service Worker (Persistente)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service-worker.ts       # Entry point del background script
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ aws-websocket.ts        # Gesti√≥n de conexiones WebSocket
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ storage-manager.ts      # Manejo de chrome.storage
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ connection-health.ts    # Monitoreo de conectividad
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ content/                    # Content Scripts (Inyectados)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ meeting-injector.ts     # Script principal inyectado
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ audio-capture.ts        # Captura de MediaStream
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ platform-detectors/     # Detectores por plataforma
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ zoom-detector.ts    # Detecci√≥n espec√≠fica Zoom
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ teams-detector.ts   # Detecci√≥n espec√≠fica Teams
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ meet-detector.ts    # Detecci√≥n espec√≠fica Google Meet
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ generic-detector.ts # Detector gen√©rico
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui-overlay.ts           # Overlay de insights en p√°gina
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ sidepanel/                  # Panel Lateral Principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sidepanel.html          # HTML del panel lateral
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sidepanel.ts            # Controlador principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/             # Web Components modulares
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base-component.ts   # Clase base para componentes
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transcription-feed.ts # Feed de transcripci√≥n en vivo
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ insight-cards.ts    # Tarjetas de insights animadas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ search-panel.ts     # Panel de b√∫squeda vectorial
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ meeting-controls.ts # Controles de reuni√≥n
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ email-draft.ts      # Generador de emails
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/               # Servicios del panel
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ websocket-client.ts # Cliente WebSocket
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ state-manager.ts    # Gesti√≥n de estado local
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ animation-engine.ts # Motor de animaciones
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ styles/                 # CSS modular
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ main.css            # Estilos principales
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ components.css      # Estilos de componentes
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ animations.css      # Animaciones CSS
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ themes.css          # Variables de theming
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ popup/                      # Popup de Configuraci√≥n
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ popup.html              # Interfaz de configuraci√≥n
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ popup.ts                # L√≥gica de configuraci√≥n
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config-manager.ts       # Gesti√≥n de configuraci√≥n
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ shared/                     # Utilidades Compartidas
‚îÇ       ‚îú‚îÄ‚îÄ types.ts                # Tipos TypeScript compartidos
‚îÇ       ‚îú‚îÄ‚îÄ constants.ts            # Constantes globales
‚îÇ       ‚îú‚îÄ‚îÄ utils.ts                # Utilidades generales
‚îÇ       ‚îî‚îÄ‚îÄ i18n.ts                 # Internacionalizaci√≥n
‚îÇ
‚îú‚îÄ‚îÄ assets/                         # Recursos Est√°ticos
‚îÇ   ‚îú‚îÄ‚îÄ icons/                      # Iconos de la extensi√≥n
‚îÇ   ‚îú‚îÄ‚îÄ images/                     # Im√°genes y gr√°ficos
‚îÇ   ‚îî‚îÄ‚îÄ sounds/                     # Sonidos de notificaci√≥n
‚îÇ
‚îî‚îÄ‚îÄ build/                          # Configuraci√≥n de Build
    ‚îú‚îÄ‚îÄ webpack.config.js           # Configuraci√≥n Webpack
    ‚îú‚îÄ‚îÄ tsconfig.json               # Configuraci√≥n TypeScript
    ‚îî‚îÄ‚îÄ package.json                # Dependencias del frontend
```

#### Flujo de Datos Frontend
```mermaid
graph TD
    A[Content Script] --> B[Audio Capture]
    B --> C[Background Service Worker]
    C --> D[WebSocket to AWS]
    D --> E[AWS Processing]
    E --> F[WebSocket Response]
    F --> C
    C --> G[Side Panel Update]
    G --> H[UI Components]
    H --> I[Animated Insights]
    
    J[User Interaction] --> G
    K[Chrome Storage] --> C
    C --> K
```

### ‚òÅÔ∏è AWS Backend (Serverless)

#### Arquitectura de Servicios
```
aws-backend/
‚îú‚îÄ‚îÄ cdk/                            # Infrastructure as Code
‚îÇ   ‚îú‚îÄ‚îÄ bin/                        # CDK entry points
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app.ts                  # CDK app definition
‚îÇ   ‚îú‚îÄ‚îÄ lib/                        # Stack definitions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ networking-stack.ts     # VPC, subnets, security groups
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api-gateway-stack.ts    # WebSocket API Gateway
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lambda-stack.ts         # Lambda functions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai-services-stack.ts    # Bedrock, Transcribe setup
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ search-stack.ts         # OpenSearch configuration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ storage-stack.ts        # S3 buckets, DynamoDB
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ monitoring-stack.ts     # CloudWatch, alarms
‚îÇ   ‚îî‚îÄ‚îÄ cdk.json                    # CDK configuration
‚îÇ
‚îú‚îÄ‚îÄ src/                            # Lambda source code
‚îÇ   ‚îú‚îÄ‚îÄ websocket/                  # WebSocket API handlers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ connect-handler.ts      # Connection establishment
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ disconnect-handler.ts   # Connection cleanup
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ message-router.ts       # Message routing logic
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ connection-store.ts     # DynamoDB connection storage
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ transcription/              # Speech processing
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transcribe-handler.ts   # Amazon Transcribe integration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ audio-processor.ts      # Audio format conversion
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ language-detector.ts    # Language detection
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ real-time-stream.ts     # Streaming transcription
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ ai-analysis/                # AI processing pipeline
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bedrock-client.ts       # Amazon Bedrock wrapper
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ conversation-analyzer.ts # Conversation analysis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ insight-extractor.ts    # Insight extraction
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ email-generator.ts      # Email draft generation
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prompts/                # Prompt templates
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ sales-analysis.ts   # Sales conversation prompts
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ insight-generation.ts # Insight prompts
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ email-templates.ts  # Email generation prompts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ vector-search/              # Semantic search system
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ opensearch-client.ts    # OpenSearch wrapper
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ embedding-service.ts    # Text embedding generation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ document-indexer.ts     # Document indexing pipeline
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ search-engine.ts        # Semantic search logic
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ relevance-scorer.ts     # Search result scoring
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ document-processing/        # Knowledge base management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ s3-processor.ts         # S3 document processing
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pdf-extractor.ts        # PDF text extraction
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ docx-extractor.ts       # Word document extraction
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chunking-service.ts     # Document chunking
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ metadata-extractor.ts   # Document metadata
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ shared/                     # Shared utilities
‚îÇ       ‚îú‚îÄ‚îÄ types.ts                # Shared TypeScript types
‚îÇ       ‚îú‚îÄ‚îÄ config.ts               # Configuration management
‚îÇ       ‚îú‚îÄ‚îÄ logger.ts               # Structured logging
‚îÇ       ‚îú‚îÄ‚îÄ error-handler.ts        # Error handling utilities
‚îÇ       ‚îî‚îÄ‚îÄ metrics.ts              # CloudWatch metrics
‚îÇ
‚îú‚îÄ‚îÄ tests/                          # Test suites
‚îÇ   ‚îú‚îÄ‚îÄ unit/                       # Unit tests
‚îÇ   ‚îú‚îÄ‚îÄ integration/                # Integration tests
‚îÇ   ‚îî‚îÄ‚îÄ e2e/                        # End-to-end tests
‚îÇ
‚îî‚îÄ‚îÄ docs/                           # AWS documentation
    ‚îú‚îÄ‚îÄ architecture.md             # Architecture decisions
    ‚îú‚îÄ‚îÄ deployment.md               # Deployment guide
    ‚îî‚îÄ‚îÄ api-reference.md            # API documentation
```

#### Flujo de Datos Backend
```mermaid
graph TD
    A[WebSocket API Gateway] --> B[Connection Handler]
    B --> C[Message Router]
    C --> D[Transcription Service]
    C --> E[AI Analysis Service]
    C --> F[Vector Search Service]
    
    D --> G[Amazon Transcribe]
    E --> H[Amazon Bedrock]
    F --> I[Amazon OpenSearch]
    
    G --> J[EventBridge]
    H --> J
    I --> J
    
    J --> K[Response Aggregator]
    K --> L[WebSocket Response]
    L --> A
```

## Flujo de Datos Completo

### üîÑ Procesamiento End-to-End

#### 1. Captura de Audio (Extension)
```typescript
// Flujo de captura en content script
navigator.mediaDevices.getUserMedia({ audio: true })
  .then(stream => {
    // Procesamiento local de audio
    const audioContext = new AudioContext();
    const mediaRecorder = new MediaRecorder(stream);
    
    // Env√≠o a background service worker
    chrome.runtime.sendMessage({
      type: 'AUDIO_CHUNK',
      data: audioBuffer
    });
  });
```

#### 2. Procesamiento en Background (Extension)
```typescript
// Service worker procesa y env√≠a a AWS
chrome.runtime.onMessage.addListener((message) => {
  if (message.type === 'AUDIO_CHUNK') {
    // Env√≠o v√≠a WebSocket a AWS
    websocket.send(JSON.stringify({
      action: 'processAudio',
      audioData: message.data,
      sessionId: currentSessionId
    }));
  }
});
```

#### 3. Procesamiento AWS (Backend)
```typescript
// Lambda WebSocket handler
export const handler = async (event) => {
  const { action, audioData, sessionId } = JSON.parse(event.body);
  
  switch (action) {
    case 'processAudio':
      // Pipeline paralelo
      await Promise.all([
        transcribeAudio(audioData, sessionId),
        analyzeConversation(sessionId),
        searchRelevantDocs(lastTranscription)
      ]);
      break;
  }
};
```

#### 4. Respuesta y UI Update (Extension)
```typescript
// Side panel recibe insights
websocket.onmessage = (event) => {
  const response = JSON.parse(event.data);
  
  switch (response.type) {
    case 'TRANSCRIPTION':
      updateTranscriptionFeed(response.text);
      break;
    case 'INSIGHT':
      showAnimatedInsight(response.insight);
      break;
    case 'SEARCH_RESULTS':
      updateSearchPanel(response.documents);
      break;
  }
};
```

## Dependencias Externas

### üì¶ Frontend Dependencies
```json
{
  "dependencies": {
    "@types/chrome": "^0.0.268",
    "aws-sdk": "^2.1691.0",
    "typescript": "^5.3.0"
  },
  "devDependencies": {
    "webpack": "^5.89.0",
    "@typescript-eslint/eslint-plugin": "^6.13.0",
    "web-ext": "^7.8.0"
  }
}
```

### ‚òÅÔ∏è Backend Dependencies
```json
{
  "dependencies": {
    "aws-cdk-lib": "^2.109.0",
    "@aws-sdk/client-bedrock-runtime": "^3.456.0",
    "@aws-sdk/client-transcribe": "^3.456.0",
    "@opensearch-project/opensearch": "^2.4.0"
  }
}
```

## Cambios Significativos Recientes

### ‚úÖ Configuraci√≥n Inicial (Actual)
- Establecida estructura completa de documentaci√≥n
- Definida arquitectura Chrome Extension + AWS serverless
- Configurados .clinerules espec√≠ficos para el proyecto
- Creada configuraci√≥n de repositorio centralizada

### üîÑ Pr√≥ximos Cambios Planificados
- Implementaci√≥n de estructura de directorios actual
- Configuraci√≥n de Manifest v3 funcional
- Setup inicial de infraestructura AWS con CDK
- Prototipos de UI con animaciones CSS

## Integraci√≥n de Retroalimentaci√≥n del Usuario

### üìä M√©tricas de Usuario Planificadas
```typescript
// M√©tricas que se capturar√°n
interface UserMetrics {
  sessionDuration: number;
  insightsGenerated: number;
  searchQueriesPerformed: number;
  emailDraftsCreated: number;
  userSatisfactionRating: number;
}
```

### üîÑ Feedback Loop
1. **Captura**: M√©tricas autom√°ticas + feedback expl√≠cito
2. **An√°lisis**: CloudWatch Insights + dashboard personalizado
3. **Iteraci√≥n**: Mejoras basadas en patrones de uso
4. **Validaci√≥n**: A/B testing de nuevas caracter√≠sticas

## Consideraciones de Arquitectura

### üîí Seguridad
- Content Security Policy estricto en extension
- Validaci√≥n de input en todos los puntos de entrada
- Encriptaci√≥n end-to-end para datos sensibles
- Rate limiting en APIs para prevenir abuso

### ‚ö° Performance
- Lazy loading de componentes no cr√≠ticos
- Caching inteligente en chrome.storage
- Compression de payloads WebSocket
- Optimizaci√≥n de consultas OpenSearch

### üåê Escalabilidad
- Arquitectura event-driven para desacoplamiento
- Auto-scaling de Lambda functions
- Multi-regi√≥n deployment capability
- Horizontal scaling de OpenSearch cluster

---

*√öltima actualizaci√≥n: 14 de junio, 2025*
*Versi√≥n de arquitectura: v1.0.0*
*Pr√≥xima revisi√≥n: Despu√©s de implementar estructura inicial*
